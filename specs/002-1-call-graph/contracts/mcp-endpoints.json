{
  "title": "MCP Endpoints - Call Graph Support",
  "version": "1.0.0",
  "description": "MCP protocol endpoints that require call graph data",
  "endpoints": {
    "who_calls": {
      "description": "Find all functions that call a specific target function",
      "request": {
        "type": "object",
        "properties": {
          "function_name": {
            "type": "string",
            "description": "Name of the function to find callers for",
            "example": "ext4_inode_alloc"
          },
          "config": {
            "type": "string",
            "description": "Kernel configuration context",
            "example": "defconfig",
            "nullable": true
          }
        },
        "required": ["function_name"]
      },
      "response": {
        "type": "object",
        "properties": {
          "callers": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "caller_name": {"type": "string"},
                "call_sites": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "file_path": {"type": "string"},
                      "line_number": {"type": "integer"},
                      "call_type": {"type": "string", "enum": ["Direct", "Indirect", "Macro"]}
                    },
                    "required": ["file_path", "line_number", "call_type"]
                  }
                }
              },
              "required": ["caller_name", "call_sites"]
            }
          },
          "total_callers": {"type": "integer"}
        },
        "required": ["callers", "total_callers"]
      }
    },
    "list_dependencies": {
      "description": "Find all functions that a specific function calls",
      "request": {
        "type": "object",
        "properties": {
          "function_name": {
            "type": "string",
            "description": "Name of the function to find dependencies for",
            "example": "ext4_create"
          },
          "config": {
            "type": "string",
            "description": "Kernel configuration context",
            "nullable": true
          },
          "max_depth": {
            "type": "integer",
            "description": "Maximum call chain depth to explore",
            "default": 5,
            "minimum": 1,
            "maximum": 20
          }
        },
        "required": ["function_name"]
      },
      "response": {
        "type": "object",
        "properties": {
          "dependencies": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "callee_name": {"type": "string"},
                "call_sites": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "file_path": {"type": "string"},
                      "line_number": {"type": "integer"},
                      "call_type": {"type": "string"},
                      "depth": {"type": "integer"}
                    },
                    "required": ["file_path", "line_number", "call_type", "depth"]
                  }
                }
              },
              "required": ["callee_name", "call_sites"]
            }
          },
          "total_dependencies": {"type": "integer"}
        },
        "required": ["dependencies", "total_dependencies"]
      }
    },
    "entrypoint_flow": {
      "description": "Trace call flow from kernel entry point to implementation",
      "request": {
        "type": "object",
        "properties": {
          "entrypoint": {
            "type": "string",
            "description": "Entry point identifier (syscall, ioctl, etc.)",
            "example": "sys_open"
          },
          "target_function": {
            "type": "string",
            "description": "Target implementation function",
            "example": "ext4_file_open",
            "nullable": true
          },
          "config": {
            "type": "string",
            "description": "Kernel configuration context",
            "nullable": true
          }
        },
        "required": ["entrypoint"]
      },
      "response": {
        "type": "object",
        "properties": {
          "call_paths": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "function_name": {"type": "string"},
                      "file_path": {"type": "string"},
                      "line_number": {"type": "integer"},
                      "call_type": {"type": "string"}
                    },
                    "required": ["function_name", "file_path", "line_number", "call_type"]
                  }
                },
                "depth": {"type": "integer"},
                "confidence": {"type": "number", "minimum": 0, "maximum": 1}
              },
              "required": ["path", "depth", "confidence"]
            }
          },
          "total_paths": {"type": "integer"}
        },
        "required": ["call_paths", "total_paths"]
      }
    },
    "impact_of": {
      "description": "Analyze the impact/blast radius of changes to a function",
      "request": {
        "type": "object",
        "properties": {
          "function_name": {
            "type": "string",
            "description": "Function to analyze impact for",
            "example": "ext4_writepage"
          },
          "analysis_depth": {
            "type": "integer",
            "description": "Depth of impact analysis",
            "default": 3,
            "minimum": 1,
            "maximum": 10
          },
          "config": {
            "type": "string",
            "description": "Kernel configuration context",
            "nullable": true
          }
        },
        "required": ["function_name"]
      },
      "response": {
        "type": "object",
        "properties": {
          "direct_callers": {"type": "integer"},
          "total_affected": {"type": "integer"},
          "affected_subsystems": {
            "type": "array",
            "items": {"type": "string"}
          },
          "critical_paths": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "entrypoint": {"type": "string"},
                "path_length": {"type": "integer"},
                "subsystem": {"type": "string"}
              },
              "required": ["entrypoint", "path_length", "subsystem"]
            }
          },
          "risk_level": {
            "type": "string",
            "enum": ["Low", "Medium", "High", "Critical"]
          }
        },
        "required": ["direct_callers", "total_affected", "affected_subsystems", "critical_paths", "risk_level"]
      }
    }
  }
}
