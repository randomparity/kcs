# Semantic Search Configuration Example
#
# This file contains example configuration for the KCS semantic search engine.
# Copy this file to semantic_search.yaml and customize as needed.
#
# Configuration can also be provided via environment variables with the
# SEMANTIC_SEARCH_ prefix. Environment variables take precedence over this file.

# Embedding model configuration
embedding:
  # Hugging Face model name for generating embeddings
  model_name: "BAAI/bge-small-en-v1.5"

  # Directory to cache downloaded models (optional)
  # If not specified, defaults to ~/.cache/semantic_search/models
  model_cache_dir: "/path/to/model/cache"

  # Embedding vector dimension (must match model)
  dimension: 384

  # Device for inference: cpu, cuda, or auto
  device: "cpu"

  # Whether to trust remote code in models (security consideration)
  trust_remote_code: false

  # Whether to normalize embeddings for cosine similarity
  normalize_embeddings: true

  # Batch size for embedding generation
  batch_size: 32

  # Maximum sequence length for model input
  max_length: 512

# Database configuration
database:
  # PostgreSQL connection settings
  host: "localhost"
  port: 5432
  database: "kcs"
  username: "kcs"
  password: ""  # Use environment variable SEMANTIC_SEARCH_DB_PASSWORD

  # Connection pool settings
  min_pool_size: 2
  max_pool_size: 10
  command_timeout: 30
  connection_timeout: 10
  ssl_mode: "prefer"

# Search behavior configuration
search:
  # Default maximum number of results to return
  default_max_results: 10

  # Default similarity threshold (0.0 to 1.0)
  default_similarity_threshold: 0.7

  # Text chunking settings
  chunk_size: 500
  chunk_overlap: 50

  # Hybrid scoring settings
  enable_bm25: true
  bm25_weight: 0.3      # Weight for BM25 text similarity
  semantic_weight: 0.7  # Weight for semantic similarity (must sum to 1.0)

  # Query result caching
  cache_query_results: true
  cache_ttl_seconds: 3600

# Performance and optimization settings
performance:
  # Query timeout limits (milliseconds)
  max_query_time_ms: 600
  max_indexing_time_ms: 30000

  # Optimization features
  enable_query_optimization: true
  enable_parallel_processing: true

  # Concurrency limits
  max_concurrent_requests: 10
  embedding_batch_size: 32

  # Vector index configuration
  vector_index_lists: 100  # Number of lists for IVFFlat index

  # Maintenance settings
  cleanup_interval_hours: 24

  # Logging for slow operations
  log_slow_queries: true
  slow_query_threshold_ms: 1000

# Logging configuration
log_level: "INFO"  # TRACE, DEBUG, INFO, WARNING, ERROR
log_format: "json"  # json, pretty, compact
enable_metrics: true

# Example environment variable mappings:
#
# SEMANTIC_SEARCH_MODEL_NAME=BAAI/bge-small-en-v1.5
# SEMANTIC_SEARCH_MODEL_CACHE_DIR=/opt/semantic_search/models
# SEMANTIC_SEARCH_DB_HOST=database.example.com
# SEMANTIC_SEARCH_DB_PASSWORD=secure_password
# SEMANTIC_SEARCH_DEFAULT_MAX_RESULTS=20
# SEMANTIC_SEARCH_LOG_LEVEL=DEBUG
#
# Database connection can also use standard PostgreSQL environment variables:
# POSTGRES_HOST=database.example.com
# POSTGRES_PORT=5432
# POSTGRES_DB=kcs
# POSTGRES_USER=kcs
# POSTGRES_PASSWORD=secure_password
#
# Or use a complete database URL:
# DATABASE_URL=postgresql://user:password@host:port/database
